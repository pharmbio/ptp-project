%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% This is just an example/guide for you to refer to when submitting manuscripts
% to Frontiers, it is not mandatory to use Frontiers .cls files nor
% frontiers.tex  % This will only generate the Manuscript, the final article
% will be typeset by Frontiers after acceptance.
%                                              %
%                                                                                                                                                         %
% When submitting your files, remember to upload this *tex file, the pdf
% generated with it, the *bib file (if bibliography is not within the *tex) and
% all the figures.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Version 3.3 Generated 2016/11/10 %%% You will need to have the following
% packages installed: datetime, fmtcount, etoolbox, fcprefix, which are
% normally inlcuded in WinEdt. %%% In http://www.ctan.org/ you can find the
% packages and how to install them, if necessary. %%% NB logo1.jpg is required
% in the path in order to correctly compile front page header %%%

\documentclass[utf8]{frontiersSCNS} % for Science, Engineering and Humanities and Social Sciences articles
%\documentclass[utf8]{frontiersHLTH} % for Health articles
%\documentclass[utf8]{frontiersFPHY} % for Physics and Applied Mathematics and Statistics articles

%\setcitestyle{square} % for Physics and Applied Mathematics and Statistics articles
\usepackage{url,hyperref,lineno,microtype,subcaption}
\usepackage[onehalfspacing]{setspace}
\usepackage{todonotes}
\newcommand{\todoil}[1]{\todo[inline]{#1}}

%\linenumbers


% Leave a blank line between paragraphs instead of using \\


\def\keyFont{\fontsize{8}{11}\helveticabold }
\def\firstAuthorLast{Lampa {et~al.}} %use et al only if is more than 1 author
\def\Authors{Samuel Lampa\,$^{1,*}$, Jonathan Alvarsson\,$^{1}$, Staffan Arvidsson\,$^{1}$, Arvid Berg\,$^{1}$ and Ola Spjuth\,$^{1,2}$}
% Affiliations should be keyed to the author's name with superscript numbers
% and be listed as follows: Laboratory, Institute, Department, Organization,
% City, State abbreviation (USA, Canada, Australia), and Country (without
% detailed address information such as city zip codes or street names).  If one
% of the authors has a change of address, list the new address below the
% correspondence details using a superscript symbol and use the same symbol to
% indicate the author in the author list.
\def\Address{$^{1}$Pharmaceutical Bioinformatics group, Department of Pharmaceutical Biosciences, Uppsala University, Uppsala, Sweden}
% The Corresponding Author should be marked with an asterisk Provide the exact
% contact address (this time including street name and city zip code) and email
% of the corresponding author
\def\corrAuthor{Corresponding Author}

\def\corrEmail{samuel.lampa@farmbio.uu.se}




\begin{document}

\onecolumn
\firstpage{1}

\title[Predicting off-target binding with confidence using Conformal
Prediction]{Predicting off-target binding with confidence using Conformal
Prediction}

\author[\firstAuthorLast ]{\Authors} %This field will be automatically populated
\address{} %This field will be automatically populated
\correspondance{} %This field will be automatically populated

\extraAuth{}% If there are more than 1 corresponding author, comment this line and uncomment the next one.
%\extraAuth{corresponding Author2 \\ Laboratory X2, Institute X2, Department
%X2, Organization X2, Street X2, City X2 , State XX2 (only USA, Canada and
%Australia), Zip Code2, X2 Country X2, email2@uni2.edu}


\maketitle


\begin{abstract}

%%% Leave the Abstract empty if your article does not require one, please see the Summary Table for full details.
%\section{}
%For full guidelines regarding your manuscript please refer to
%    \href{http://www.frontiersin.org/about/AuthorGuidelines}{Author
%    Guidelines}.
%
%As a primary goal, the abstract should render the general significance and
%    conceptual advance of the work clearly accessible to a broad readership.
%    References should not be cited in the abstract. Leave the Abstract empty if
%    your article does not require one, please see
%    \href{http://www.frontiersin.org/about/AuthorGuidelines#SummaryTable}{Summary
%    Table} for details according to article type.

%\todoil{Can you really have refs in abstract?}
%\todoil{--- No not really, the abstract should probably be completely rewritten. // jonalv}
%\todoil{--- No refs and no abbreviations. /Ola}
%Off-target pharmacology and polypharmacology has big implications on drug
%efficacy and safety, and prediction of target binding profiles for ligands is
%an important task that can aid early drug discovery \cite{Bowes2012}.
%However, available methods for ligand-based target profiling do not offer
%valid measures of confidence in predictions or well-calibrated probabilities.
%We present an approach for ligand-based target profiling using probabilistic
%predictions, delivering target profiles with valid predictions of the
%probability for the query compound to interact with each target. The
%probabilities are calculated using the Conformal Prediction methodology
%\cite{Vovk2005}, with support vector machines for modeling and chemical
%structures described by the signature molecular descriptor \cite{Faulon2003}.
%We study profiles for different sets of targets, including a subset of the
%minimal panel of 44 targets for broad early hazard assessment suggested by
%\cite{Bowes2012}, but also the applicability of larger as well as focused
%target sets. The resulting method is available as an online Web service via
%an API, and we also make the complete workflow for reproducing the study
%together with all models publicly available.

Multiple ligand-based models are widely used in drug discovery to obtain an early indication of potential off-target predictions that could be linked to drug efficacy and safety. Another application is to combine models into a profile allowing to compare and search for compounds with similar profile. Most contemporary methods and implementations however lack valid measures of confidence in predictions, outputting point predictions. We here describe the use of conformal prediction for predicting off-target interactions based on data from 44 targets from the ExCAPE database, selected for their value in broad early hazard assessment. We used upport vector machines as underlying modelling methodology and chemical structures were described by the signature molecular descriptor. With conformal prediction, the results are presented as prediction intervals. The entire preprocessing and model training process is openly available as a scientific workflow on github, rendering it completely reproducible. The resulting models are published online and are available via a graphical web page and an OpenAPI for programmatic access.


\tiny
 \keyFont{ \section{Keywords:} drug discovery, predictive modelling, conformal prediction, machine learning, off-target, adverse effects} %All article types: you may provide up to 8 keywords; at least 5 are mandatory.
\end{abstract}

\section{Introduction}
\todoil{Expand the intro below which is just taken from the abstract}

%Introduce off target binding as a problem, and the value of predictions

Off-target pharmacology and polypharmacology has big implications on drug
efficacy and safety, and prediction of target binding profiles for ligands is
an important task that can aid early drug discovery \cite{Bowes2012}.
However, available methods for ligand-based target profiling do not offer
valid measures of confidence in predictions or well-calibrated probabilities.
We present an approach for ligand-based target profiling using probabilistic
predictions, delivering target profiles with valid predictions of the
probability for the query compound to interact with each target. The
probabilities are calculated using the Conformal Prediction methodology
\cite{Vovk2005}, with support vector machines for modeling and chemical structures
described by the signature descriptor \cite{Faulon2003}. We study profiles
for different sets of targets, including a subset of the minimal panel of 44
targets for broad early hazard assessment suggested by \cite{Bowes2012}, but
also the applicability of larger as well as focused target sets.

%Prior art - what has been done before?
Earlier studies...


%What is the motivation for the study, and what will we describe in this manuscript
In this manuscript we...



%%%%%%%%%%%%%%%%%%
%Methods
%%%%%%%%%%%%%%%%%%
\section{Methods}

The dataset used for information about binding association between ligands
and targets, was ExcapeDB~\cite{Sun2017}. An extraction of only the columns
for Gene name, Original entry ID (PubChem CID or CHEMBL ID), SMILES and
Activity flag was performed in order to make subsequent data transformation
steps more performant, given the relative large size of the uncompressed
ExcapeDB data file (18 GB).

From this dataset, all rows for which there existed rows with a conflicting
activity value, were completely removed.

A subset of the panel of 44 binding targets as suggested in \cite{Bowes2012}
was selected, for which to include interaction data. Specifically, only
targets with at least 100 associated and at least 100 non-associated
compounds were kept.

Some of the gene ids used in \cite{Bowes2012} were not found in their exact
form in the ExcapeDB dataset. To resolve this, PubMed was consulted to find
synonymous gene IDs. The following replacements of gene ids were done:

i) \textit{KCNE1} was replaced with \textit{MINK1} which is present in ExcapeDB.

ii) \textit{CHRNA1} (coding for the $\alpha1$ subunit of the Acetylcholine
receptor) is excluded, as it is not present in the dataset (\textit{CHRNA4},
coding for the $\alpha4$ subunit of the Acetylcholine receptor, is present in
the dataset).

iv) Both \textit{MINK1} and \textit{CHRNA4} were removed in the filtering
step mentioned above, since the dataset did not contain more than 100 active
and 100 non-active compounds for \textit{MINK1} nor \textit{CHRNA}.

\todoil{Lets make a table out of this! including number of negatives and
positives and stuff //jonalv}
The resulting panel consists of 31 targets, represented by the following gene
IDs in the ExcapeDB dataset, and througout this article:


PDE3A, SCN5A, CCKAR, ADRB1, PTGS1, CHRM3, CHRM2, EDNRA, MAOA, LCK, PTGS2,
SLC6A2, ACHE, CNR2, CNR1, ADORA2A, OPRD1, NR3C1, AR, SLC6A4, OPRM1, HTR1A,
SLC6A3, OPRK1, AVPR1A, ADRB2, DRD2, KCNH2, DRD1, HTR2A, CHRM1.

For 21 of these targets, the dataset contained less than 100 non-active
compounds, leading to imbalanced datasets. These 21 target genes are: PDE3A,
SCN5A, CCKAR, ADRB1, PTGS1, CHRM3, CHRM2, EDNRA, MAOA, LCK, PTGS2, SLC6A2,
ACHE, CNR2, CNR1, ADORA2A, OPRD1, NR3C1, AR, SLC6A4 and OPRM1. For these 21
targets, we filled up their respective datasets with randomly selected
examples from the raw dataset which were not reported to be active for this
target, thus being ``assumed non-active''. The amount of such assumed
non-active compounds were chosen to be twice the number of actives for each
target in question.

\subsection{Software for training and cross-validation}

The software for training and cross-validation was the CPSign software
\cite{CPSignDocs} previously developed in the group. Certain modifications
were done based on needs identified in the project, which have been merged
into the latest release of the CPSign software. CPSign is a commercial
software, available from genettasoft.com [LINK].
\todoil{Add something about academic licenses?}

The computational workflows for orchestrating the extraction of data, running
CPSign, and the collection of results for summarization and plotting, were
implemented in the Go programming language, using the SciPipe workflow library
developed in the group, and which is available as open source software at
scipipe.org and github.com/scipipe/scipipe [LINK].

\subsection{Choice of cost value for liblinear}

For each of the 31 targets, we ran a parameter sweep to find the value of the cost
parameter of liblinear that gave the best efficiency measure. The efficiency
measure we used, was a slightly modified version of observed fuzziness (OF)
scores as described in \cite{Vovk2016}. Instead of using an overall OF, which
would have been been influenced more by values in the larger class in case of
imbalanced datasets, we first calculated the OF per class and divided it by
the number of examples (compounds) in that class, and finally took the mean
value of the resulting normalized OF values for each class. In other words,
we could thus call our measure a ``class-normalized observed fuzziness''
(CNOF).

The parameter sweep evaluated three values for the cost parameter, for each
target; 1, 10 and 100.

for evaluation of the CNOF score mentioned above, we ran cross-validation
through cpsign's built-in crossvalidate function, with 10 folds.  The training
approach in the crossvalidation was the same as the one used to build the final
model: Aggregated Conformal Prediction (ACP) with 10 aggregated models
(specified to cpsign's crossvalidate and train commands using the
\texttt{--nr-models} flag)

\subsection{Building final models}

Before the final training the cpsign precompute command was run, in order to
generate a sparse representation of the dataset for the final training.
The final models were then built using the CPSign train command. The cost value
used is the one obtained from the cross validation, as described above.
The training type was -- just as in the cross validation for selecting the cost
value -- Aggregated Conformal Prediction (ACP), with 10 aggregated models.

\section{Results}

\begin{figure}[h!]
\includegraphics[width=0.9\textwidth]{figures/allmodels_fillup.png}
    \caption{All models with the smaller ones being filled up with assumed non-actives}
    \label{fig:allmodels_fillup}
\end{figure}

%For \textbf{Original Research} Articles \citep{conference}, Clinical Trial Articles
%\citep{article}, and Technology Reports \citep{patent}, the introduction should
%be succinct, with no subheadings \citep{book}. For Case Reports the
%Introduction should include symptoms at presentation \citep{chapter}, physical
%exams and lab results \citep{dataset}.

%\section{Article types}
%
%For requirements for a specific article type please refer to the Article Types
%on any Frontiers journal page. Please also refer to
%\href{http://home.frontiersin.org/about/author-guidelines#Sections}{Author
%Guidelines} for further information on how to organize your manuscript in the
%required sections or their equivalents for your field

% For Original Research articles, please note that the Material and Methods
% section can be placed in any of the following ways: before Results, before
% Discussion or after Discussion.

%\section{Manuscript Formatting}
%
%\subsection{Heading Levels}
%
%%There are 5 heading levels
%
%\subsection{Level 2}
%\subsubsection{Level 3}
%\paragraph{Level 4}
%\subparagraph{Level 5}
%
%\subsection{Equations}
%Equations should be inserted in editable format from the equation editor.
%
%\begin{equation}
%\sum x+ y =Z\label{eq:01}
%\end{equation}
%
%\subsection{Figures}
%Frontiers requires figures to be submitted individually, in the same order as
%they are referred to in the manuscript. Figures will then be automatically
%embedded at the bottom of the submitted manuscript. Kindly ensure that each
%table and figure is mentioned in the text and in numerical order. Figures must
%be of sufficient resolution for publication
%\href{http://home.frontiersin.org/about/author-guidelines#ResolutionRequirements}{see
%here for examples and minimum requirements}. Figures which are not according to
%the guidelines will cause substantial delay during the production process.
%Please see
%\href{http://home.frontiersin.org/about/author-guidelines#GeneralStyleGuidelinesforFigures}{here}
%for full figure guidelines. Cite figures with subfigures as figure
%\ref{fig:2}B.
%
%
%\subsubsection{Permission to reuse and Copyright}
%Permission must be obtained for use of copyrighted material from other sources
%(including the web). Please note that it is compulsory to follow figure
%instructions.
%
%\subsection{Tables}
%Tables should be inserted at the end of the manuscript. Please build your table
%directly in LaTeX.Tables provided as jpeg/tiff files will not be accepted.
%Please note that very large tables (covering several pages) cannot be included
%in the final PDF for reasons of space. These tables will be published as
%\href{http://home.frontiersin.org/about/author-guidelines#SupplementaryMaterial}{Supplementary
%Material} on the online article page at the time of acceptance. The author will
%be notified during the typesetting of the final article if this is the case.
%
%\section{Nomenclature}
%
%\subsection{Resource Identification Initiative}
%To take part in the Resource Identification Initiative, please use the
%corresponding catalog number and RRID in your current manuscript. For more
%information about the project and for steps on how to search for an RRID,
%please click
%\href{http://www.frontiersin.org/files/pdf/letter_to_author.pdf}{here}.
%
%\subsection{Life Science Identifiers}
%Life Science Identifiers (LSIDs) for ZOOBANK registered names or nomenclatural
%acts should be listed in the manuscript before the keywords. For more
%information on LSIDs please see
%\href{http://www.frontiersin.org/about/AuthorGuidelines#InclusionofZoologicalNomenclature}{Inclusion
%of Zoological Nomenclature} section of the guidelines.
%
%
%\section{Additional Requirements}
%
%For additional requirements for specific article types and further information
%please refer to
%\href{http://www.frontiersin.org/about/AuthorGuidelines#AdditionalRequirements}{Author
%Guidelines}.

\section*{Conflict of Interest Statement}
%All financial, commercial or other relationships that might be perceived by
%the academic community as representing a potential conflict of interest must
%be disclosed. If no such relationship exists, authors will be asked to confirm
%the following statement:
\todoil{Declare working for, having worked for, and other relationships with Genetta Soft}
The authors declare that the research was conducted in the absence of any
commercial or financial relationships that could be construed as a potential
conflict of interest.

\section*{Author Contributions}

%The Author Contributions section is mandatory for all articles, including
%articles by sole authors. If an appropriate statement is not provided on
%submission, a standard one will be inserted during the production process. The
%Author Contributions statement must describe the contributions of individual
%authors referred to by their initials and, in doing so, all authors agree to be
%accountable for the content of the work. Please see
%\href{http://home.frontiersin.org/about/author-guidelines#AuthorandContributors}{here}
%for full authorship criteria.

\section*{Funding}
%Details of all funding sources should be provided, including grant numbers if
%applicable. Please ensure to add all necessary funding information, as after
%publication this is no longer possible.

\section*{Acknowledgments}
%This is a short text to acknowledge the contributions of specific colleagues,
%institutions, or agencies that aided the efforts of the authors.

\section*{Supplemental Data}
%\href{http://home.frontiersin.org/about/author-guidelines#SupplementaryMaterial}{Supplementary
%Material} should be uploaded separately on submission, if there are
%Supplementary Figures, please include the caption in the same file as the
%figure. LaTeX Supplementary Material templates can be found in the Frontiers
%LaTeX folder
%
%
\section*{References}
\bibliographystyle{frontiersinSCNS_ENG_HUMS} % for Science, Engineering and Humanities and Social Sciences articles, for Humanities and Social Sciences articles please include page numbers in the in-text citations
%\bibliographystyle{frontiersinHLTH&FPHY} % for Health, Physics and Mathematics articles
\bibliography{ptp}


% Make sure to upload the bib file along with the tex file and PDF Please see
% the test.bib file for some examples of references

\section*{Figure captions}

% Please be aware that for original research articles we only permit a combined
% number of 15 figures and tables, one figure with multiple subfigures will
% count as only one figure.  Use this if adding the figures directly in the
% mansucript, if so, please remember to also upload the files when submitting
% your article There is no need for adding the file termination, as long as you
% indicate where the file is saved. In the examples below the files (logo1.jpg
% and logos.jpg) are in the Frontiers LaTeX folder If using *.tif files convert
% them to .jpg or .png NB logo1.jpg is required in the path in order to
% correctly compile front page header %%%

%\begin{figure}[h!]
%\begin{center}
%\includegraphics[width=10cm]{logo1}% This is a *.jpg file
%\end{center}
%\caption{ Enter the caption for your figure here.  Repeat as  necessary for each of your figures}\label{fig:1}
%\end{figure}
%
%
%\begin{figure}[h!]
%\begin{center}
%\includegraphics[width=15cm]{logos}
%\end{center}
%\caption{This is a figure with sub figures, (A) is one logo, (B) is a different logo.}\label{fig:2}
%\end{figure}

% If you are submitting a figure with subfigures please combine these into one
% image file with part labels integrated.  If you don't add the figures in the
% LaTeX files, please upload them when submitting the article.  Frontiers will
% add the figures at the end of the provisional pdf automatically The use of
% LaTeX coding to draw Diagrams/Figures/Structures should be avoided. They
% should be external callouts including graphics.

\end{document}
